<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <!-- viewport-fit=cover Î²Î¿Î·Î¸Î¬ÎµÎ¹ Î½Î± Î³ÎµÎ¼Î¯Î¶ÎµÎ¹ ÏƒÏ‰ÏƒÏ„Î¬ ÏƒÎµ â€œfull screenâ€ -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <meta name="theme-color" content="#0b0f14" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <title>Daily Cashier</title>
  <link rel="manifest" href="./manifest.webmanifest" />

  <style>
    :root{
      --bg0:#070a0f;
      --bg1:#0b0f14;
      --card:#111824;
      --line:rgba(255,255,255,.10);
      --text:#eaf1ff;
      --muted:rgba(234,241,255,.72);
      --muted2:rgba(234,241,255,.55);
      --accent:#4aa3ff;
      --good:#2fe39f;
      --bad:#ff5566;

      --r:18px;

      --safeTop: env(safe-area-inset-top, 0px);
      --safeBottom: env(safe-area-inset-bottom, 0px);
      --safeLeft: env(safe-area-inset-left, 0px);
      --safeRight: env(safe-area-inset-right, 0px);
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; margin:0; }

    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 900px at 70% -10%, rgba(74,163,255,.18), transparent 55%),
        radial-gradient(900px 700px at -10% 30%, rgba(47,227,159,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    /* 100dvh Î³Î¹Î± ÏƒÏ‰ÏƒÏ„ÏŒ ÏÏˆÎ¿Ï‚ ÏƒÎµ Android (chrome bars ÎºÎ»Ï€) */
    .app{
      height: 100dvh;
      display:flex;
      flex-direction:column;
      padding: calc(var(--safeTop) + 10px) calc(var(--safeRight) + 10px) calc(var(--safeBottom) + 10px) calc(var(--safeLeft) + 10px);
      gap:10px;
    }

    /* TOPBAR Ï€Î¹Î¿ compact + Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ ÎŸÎÎŸÎœÎ‘ ÎœÎ‘Î“Î‘Î–Î™ÎŸÎ¥ */
    .topbar{
      display:flex;
      align-items:center;
      gap:10px;
      background: rgba(17,24,36,.55);
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 10px 12px;
      backdrop-filter: blur(10px);
    }

    .brand{
      flex:1;
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .shopName{
      font-weight: 1000;
      font-size: 16px;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .subline{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    select, button, input{ font: inherit; color:var(--text); }

    select{
      border:1px solid var(--line);
      background: rgba(17,24,36,.70);
      border-radius: 14px;
      height: 40px;
      padding: 0 36px 0 12px;
      appearance:none;
      background-image:
        linear-gradient(45deg, transparent 50%, var(--muted) 50%),
        linear-gradient(135deg, var(--muted) 50%, transparent 50%);
      background-position:
        calc(100% - 18px) 50%,
        calc(100% - 12px) 50%;
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
      max-width: 220px;
    }

    .iconbtn{
      border:1px solid var(--line);
      background: rgba(17,24,36,.70);
      border-radius:14px;
      height: 40px;
      width: 40px;
      display:flex;
      align-items:center;
      justify-content:center;
      position: relative;
      overflow:hidden;
    }

    .content{
      flex:1;
      min-height:0;
      display:flex;
      flex-direction:column;
    }

    /* MAIN SCROLL AREA â€“ fix scroll Ï€Î±Î½Ï„Î¿Ï */
    .view{
      flex:1;
      min-height:0;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      touch-action: pan-y;
      padding-bottom: calc(88px + var(--safeBottom)); /* Ï‡ÏÏÎ¿ Î³Î¹Î± bottom bar */
    }
    .view::-webkit-scrollbar{ width:0; height:0; }

    .card{
      background: rgba(17,24,36,.55);
      border:1px solid var(--line);
      border-radius: var(--r);
      padding: 12px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      margin-bottom:10px;
    }
    .h{ font-weight:1000; margin:0 0 8px 0; font-size:16px; }
    .muted{ color:var(--muted); }
    .muted2{ color:var(--muted2); }
    .row{ display:flex; align-items:center; gap:10px; }
    .row.space{ justify-content:space-between; }

    /* tables grid */
    .tables{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
    }
    @media (min-width: 520px){
      .tables{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    /* PRESSABLE + Î ÎŸÎ›Î¥ ÎšÎ‘Î›Î¥Î¤Î•Î¡ÎŸ RIPPLE */
    .pressable{
      position:relative;
      overflow:hidden;
      transition: transform .06s ease, filter .06s ease;
      touch-action: manipulation;
      user-select:none;
      isolation:isolate;
    }
    .pressable:active{
      transform: scale(.985);
      filter: brightness(1.10);
    }
    .ripple{
      position:absolute;
      border-radius:50%;
      pointer-events:none;
      width: 20px;
      height: 20px;
      transform: translate(-50%,-50%) scale(0);
      /* Ï€Î¹Î¿ â€œmaterialâ€ Î­Î½Ï„Î¿Î½Î¿ */
      background: rgba(255,255,255,.28);
      opacity: 1;
      animation: ripple .50s ease-out forwards;
      z-index: 2;
    }
    @keyframes ripple{
      0%{ transform: translate(-50%,-50%) scale(0); opacity: .95; }
      60%{ opacity: .35; }
      100%{ transform: translate(-50%,-50%) scale(22); opacity: 0; }
    }

    .tbtn{
      text-align:left;
      padding: 14px 14px;
      border-radius: var(--r);
      border:1px solid var(--line);
      background: rgba(17,24,36,.45);
      min-height: 74px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:4px;
    }
    .tbtn .title{ font-weight:1000; font-size:18px; letter-spacing:.2px; display:flex; align-items:center; gap:8px; }
    .tbtn .sub{ color:var(--muted); font-size:13px; }

    /* Î›Î‘ÎœÎ Î‘ÎšÎ™ */
    .led{
      width:10px; height:10px; border-radius:999px;
      background: rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.16);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.15);
      flex:0 0 auto;
    }
    .led.open{
      background: rgba(47,227,159,.85);
      border-color: rgba(47,227,159,.55);
      box-shadow: 0 0 10px rgba(47,227,159,.35);
    }

    .badge{
      position:absolute;
      right:10px;
      top:10px;
      min-width: 28px;
      height: 22px;
      padding:0 8px;
      border-radius: 999px;
      border:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      background: rgba(74,163,255,.10);
    }

    .chips{
      display:flex;
      gap:8px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      padding: 2px 2px 8px 2px;
      touch-action: pan-x;
    }
    .chips::-webkit-scrollbar{ height:0; }

    .chip{
      flex:0 0 auto;
      border:1px solid var(--line);
      background: rgba(17,24,36,.45);
      border-radius:999px;
      height: 38px;
      padding: 0 12px;
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:900;
      color: var(--muted);
      white-space:nowrap;
    }
    .chip.active{
      color: var(--text);
      border-color: rgba(74,163,255,.35);
      box-shadow: 0 0 0 3px rgba(74,163,255,.08) inset;
    }

    .list{
      display:flex;
      flex-direction:column;
      border:1px solid var(--line);
      border-radius: var(--r);
      overflow:hidden;
      background: rgba(17,24,36,.35);
    }
    .li{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 12px;
      border-top:1px solid rgba(255,255,255,.07);
      gap:12px;
    }
    .li:first-child{ border-top:none; }
    .li .left{ min-width:0; flex:1; }
    .li .name{ font-weight:1000; line-height:1.15; margin:0; font-size:15px; }
    .li .meta{ font-size:12px; color:var(--muted2); margin-top:3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .price{ font-weight:1000; font-size:15px; white-space:nowrap; }

    .qty{ display:flex; align-items:center; gap:6px; flex:0 0 auto; }
    .qbtn{
      height: 34px;
      min-width: 34px;
      padding: 0 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(17,24,36,.55);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      position:relative;
      overflow:hidden;
    }
    .qnum{ min-width: 22px; text-align:center; font-weight:1000; }

    /* bottom bar */
    .bottom{
      position:fixed;
      left:0; right:0;
      bottom:0;
      padding: 10px calc(var(--safeRight) + 10px) calc(var(--safeBottom) + 10px) calc(var(--safeLeft) + 10px);
      background: linear-gradient(180deg, transparent, rgba(7,10,15,.72) 30%, rgba(7,10,15,.92));
      backdrop-filter: blur(10px);
      pointer-events:none;
    }
    .bottom .bar{
      pointer-events:auto;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
    }
    @media (min-width:520px){
      .bottom .bar{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    .btn{
      border:1px solid var(--line);
      background: rgba(17,24,36,.62);
      border-radius: 16px;
      height: 48px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      position:relative;
      overflow:hidden;
    }
    .btn.good{ border-color: rgba(47,227,159,.35); box-shadow:0 0 0 3px rgba(47,227,159,.06) inset; }
    .btn.bad{ border-color: rgba(255,85,102,.35); box-shadow:0 0 0 3px rgba(255,85,102,.06) inset; }
    .btn.accent{ border-color: rgba(74,163,255,.35); box-shadow:0 0 0 3px rgba(74,163,255,.06) inset; }

    /* full-width button helper */
    .bar.full .btn.full{
      grid-column: 1 / -1; /* Ï€Î¹Î¬Î½ÎµÎ¹ ÏŒÎ»Î¿ Ï„Î¿ Ï€Î»Î¬Ï„Î¿Ï‚ */
    }

    button, .li, .chip, .tbtn { cursor:pointer; }
  </style>
</head>

<body>
  <div class="app" id="app">
    <div class="topbar">
      <div class="brand">
        <div class="shopName" id="shopNameTop">â€”</div>
        <div class="subline" id="topSub">â€”</div>
      </div>

      <select id="userSelect" title="Î§ÏÎ®ÏƒÏ„Î·Ï‚"></select>
      <button class="iconbtn pressable" id="btnSettings" title="Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚">âš™ï¸</button>
    </div>

    <div class="content">
      <div class="view" id="view"></div>
    </div>
  </div>

  <div class="bottom" id="bottom">
    <div class="bar" id="bottomBar"></div>
  </div>

  <script>
    const LS_KEY = "daily_cashier_db_v3";
    const TODAY = new Date().toISOString().slice(0,10);

    const el = (id) => document.getElementById(id);
    const view = el("view");
    const bottom = el("bottom");
    const bottomBar = el("bottomBar");

    function haptic(ms=10){
      try{ if(navigator.vibrate) navigator.vibrate(ms); }catch{}
    }

    function addRipple(elem, x, y){
      const r = elem.getBoundingClientRect();
      const rx = (x ?? (r.left + r.width/2)) - r.left;
      const ry = (y ?? (r.top + r.height/2)) - r.top;
      const rip = document.createElement("span");
      rip.className = "ripple";
      rip.style.left = rx + "px";
      rip.style.top  = ry + "px";
      elem.appendChild(rip);
      rip.addEventListener("animationend", ()=> rip.remove());
    }
    function makePressable(elem, vib=10){
      if(!elem) return;
      elem.classList.add("pressable");
      const down = (ev)=>{
        const t = ev.touches?.[0];
        addRipple(elem, t?.clientX ?? ev.clientX, t?.clientY ?? ev.clientY);
        haptic(vib);
      };
      elem.addEventListener("pointerdown", down, {passive:true});
      elem.addEventListener("touchstart", down, {passive:true});
    }

    function euro(x){
      const n = Number(x || 0);
      return n.toLocaleString("el-GR",{minimumFractionDigits:2, maximumFractionDigits:2}) + " â‚¬";
    }
    function uid(){ return Math.random().toString(36).slice(2) + Date.now().toString(36); }

    function loadDB(){
      try{ const raw = localStorage.getItem(LS_KEY); if(raw) return JSON.parse(raw); }catch(e){}
      return null;
    }
    function defaultDB(){
      return {
        shopName: "Î¤Î¿ ÎœÎ±Î³Î±Î¶Î¯ Î¼Î¿Ï…",
        users: [{ id:"u1", name:"Î¥Ï€Î¬Î»Î»Î·Î»Î¿Ï‚ 1", pin:"1111" }],
        currentUserId: "u1",
        tables: [
          { id:"T1",  label:"T1" }, { id:"T2",  label:"T2" }, { id:"T3",  label:"T3" }, { id:"T4",  label:"T4" },
          { id:"T5",  label:"T5" }, { id:"T6",  label:"T6" }, { id:"BAR", label:"BAR" }, { id:"OUT", label:"Î•ÎÎ©" }
        ],
        menu: {
          categories: [
            { id:"coffee_hot",  name:"ÎšÎ±Ï†Î­Î´ÎµÏ‚ â€“ Î–ÎµÏƒÏ„Î¿Î¯", emoji:"â˜•" },
            { id:"coffee_cold", name:"ÎšÎ±Ï†Î­Î´ÎµÏ‚ â€“ ÎšÏÏÎ¿Î¹",  emoji:"ğŸ§Š" },
            { id:"tea",         name:"Î¤ÏƒÎ¬Î¹ â€“ Î–ÎµÏƒÏ„Î¬",     emoji:"ğŸ«–" },
            { id:"choco",       name:"Î£Î¿ÎºÎ¿Î»Î¬Ï„ÎµÏ‚ / Î“Î±Î»Î±ÎºÏ„ÎµÏÎ¬", emoji:"ğŸ«" },
            { id:"soft",        name:"Î‘Î½Î±ÏˆÏ…ÎºÏ„Î¹ÎºÎ¬ â€“ ÎÎµÏÎ¬", emoji:"ğŸ¥¤" },
            { id:"juice",       name:"Î§Ï…Î¼Î¿Î¯ â€“ Smoothies", emoji:"ğŸŠ" },
            { id:"snack",       name:"Î£Î½Î±Îº â€“ Î“Î»Ï…ÎºÎ¬",      emoji:"ğŸ¥" },
            { id:"beer",        name:"ÎœÏ€ÏÏÎµÏ‚",            emoji:"ğŸº" },
            { id:"wine",        name:"ÎšÏÎ±ÏƒÎ¹Î¬",            emoji:"ğŸ·" },
            { id:"spirit",      name:"Î Î¿Ï„Î¬",              emoji:"ğŸ¥ƒ" },
            { id:"cocktail",    name:"ÎšÎ¿ÎºÏ„Î­Î¹Î»",           emoji:"ğŸ¸" },
            { id:"extras",      name:"Extras",            emoji:"â•" }
          ],
          products: [
            { id:"p_espresso_single", cat:"coffee_hot", name:"Espresso Î¼Î¿Î½ÏŒÏ‚", price:2.60 },
            { id:"p_espresso_double", cat:"coffee_hot", name:"Espresso Î´Î¹Ï€Î»ÏŒÏ‚", price:3.20 },
            { id:"p_espresso_macchiato", cat:"coffee_hot", name:"Espresso macchiato", price:2.90 },
            { id:"p_americano", cat:"coffee_hot", name:"Americano", price:3.20 },
            { id:"p_cappuccino", cat:"coffee_hot", name:"Cappuccino", price:3.60 },
            { id:"p_cappuccino_double", cat:"coffee_hot", name:"Cappuccino Î´Î¹Ï€Î»ÏŒÏ‚", price:4.20 },
            { id:"p_latte_macchiato", cat:"coffee_hot", name:"Latte macchiato", price:4.20 },
            { id:"p_flat_white", cat:"coffee_hot", name:"Flat white", price:4.40 },
            { id:"p_mocha", cat:"coffee_hot", name:"Mocha", price:4.50 },
            { id:"p_filter", cat:"coffee_hot", name:"ÎšÎ±Ï†Î­Ï‚ Ï†Î¯Î»Ï„ÏÎ¿Ï…", price:3.00 },

            { id:"p_freddo_espresso", cat:"coffee_cold", name:"Freddo espresso", price:3.80 },
            { id:"p_freddo_cappuccino", cat:"coffee_cold", name:"Freddo cappuccino", price:4.20 },
            { id:"p_iced_latte", cat:"coffee_cold", name:"Iced latte", price:4.50 },
            { id:"p_cold_brew", cat:"coffee_cold", name:"Cold brew", price:4.80 },
            { id:"p_frappe", cat:"coffee_cold", name:"Frappe", price:3.50 },

            { id:"p_tea_basic", cat:"tea", name:"Î¤ÏƒÎ¬Î¹ (Î¼Î±ÏÏÎ¿/Ï€ÏÎ¬ÏƒÎ¹Î½Î¿/Î²ÏŒÏ„Î±Î½Î±)", price:3.20 },
            { id:"p_tea_fruit", cat:"tea", name:"Î¤ÏƒÎ¬Î¹ Ï†ÏÎ¿ÏÏ„Ï‰Î½", price:3.50 },
            { id:"p_chai_latte", cat:"tea", name:"Chai latte", price:4.30 },

            { id:"p_hot_chocolate", cat:"choco", name:"Î–ÎµÏƒÏ„Î® ÏƒÎ¿ÎºÎ¿Î»Î¬Ï„Î±", price:4.20 },
            { id:"p_cold_chocolate", cat:"choco", name:"ÎšÏÏÎ± ÏƒÎ¿ÎºÎ¿Î»Î¬Ï„Î±", price:4.50 },
            { id:"p_white_chocolate", cat:"choco", name:"Î›ÎµÏ…ÎºÎ® ÏƒÎ¿ÎºÎ¿Î»Î¬Ï„Î±", price:4.50 },
            { id:"p_cocoa", cat:"choco", name:"ÎšÎ±ÎºÎ¬Î¿", price:4.00 },

            { id:"p_cola", cat:"soft", name:"Coca-Cola / Zero / Fanta (0,33l)", price:3.40 },
            { id:"p_ice_tea", cat:"soft", name:"Ice Tea", price:3.60 },
            { id:"p_soda_tonic", cat:"soft", name:"Î£ÏŒÎ´Î± / Î¤ÏŒÎ½Î¹Îº", price:3.20 },
            { id:"p_water_033", cat:"soft", name:"ÎœÎµÏ„Î±Î»Î»Î¹ÎºÏŒ Î½ÎµÏÏŒ (0,33l)", price:2.80 },
            { id:"p_water_075", cat:"soft", name:"ÎœÎµÏ„Î±Î»Î»Î¹ÎºÏŒ Î½ÎµÏÏŒ (0,75l)", price:5.50 },

            { id:"p_orange_juice", cat:"juice", name:"Î¦Ï…ÏƒÎ¹ÎºÏŒÏ‚ Ï‡Ï…Î¼ÏŒÏ‚ Ï€Î¿ÏÏ„Î¿ÎºÎ¬Î»Î¹", price:4.50 },
            { id:"p_mix_juice", cat:"juice", name:"Î§Ï…Î¼ÏŒÏ‚ Î±Î½Î¬Î¼ÎµÎ¹ÎºÏ„Î¿Ï‚", price:4.80 },
            { id:"p_fruit_smoothie", cat:"juice", name:"Smoothie Ï†ÏÎ¿ÏÏ„Ï‰Î½", price:5.80 },
            { id:"p_milkshake", cat:"juice", name:"Milkshake", price:5.50 },

            { id:"p_croissant_plain", cat:"snack", name:"ÎšÏÎ¿Ï…Î±ÏƒÎ¬Î½ ÏƒÎºÎ­Ï„Î¿", price:2.80 },
            { id:"p_croissant_choco", cat:"snack", name:"ÎšÏÎ¿Ï…Î±ÏƒÎ¬Î½ ÏƒÎ¿ÎºÎ¿Î»Î¬Ï„Î±", price:3.20 },
            { id:"p_muffin", cat:"snack", name:"ÎœÎ¬Ï†Î¹Î½", price:3.50 },
            { id:"p_cake_piece", cat:"snack", name:"ÎšÎ­Î¹Îº (ÎºÎ¿Î¼Î¼Î¬Ï„Î¹)", price:4.20 },
            { id:"p_cheesecake", cat:"snack", name:"Cheesecake", price:4.80 },
            { id:"p_cookies", cat:"snack", name:"ÎœÏ€Î¹ÏƒÎºÏŒÏ„Î±", price:2.50 },
            { id:"p_toast_ham", cat:"snack", name:"Î¤Î¿ÏƒÏ„ Î¶Î±Î¼Ï€ÏŒÎ½-Ï„Ï…ÏÎ¯", price:4.50 },
            { id:"p_toast_veg", cat:"snack", name:"Î¤Î¿ÏƒÏ„ vegetarian", price:4.80 },

            { id:"p_beer_draft", cat:"beer", name:"ÎœÏ€ÏÏÎ± Î²Î±ÏÎµÎ»Î¯ÏƒÎ¹Î± (0,5l)", price:5.20 },
            { id:"p_beer_bottle", cat:"beer", name:"ÎœÏ€ÏÏÎ± ÎµÎ¼Ï†Î¹Î±Î»Ï‰Î¼Î­Î½Î· (0,33l)", price:4.20 },
            { id:"p_weissbier", cat:"beer", name:"Weissbier (0,5l)", price:5.50 },
            { id:"p_beer_zero", cat:"beer", name:"ÎœÏ€ÏÏÎ± Ï‡Ï‰ÏÎ¯Ï‚ Î±Î»ÎºÎ¿ÏŒÎ»", price:4.20 },

            { id:"p_wine_glass", cat:"wine", name:"ÎšÏÎ±ÏƒÎ¯ Ï€Î¿Ï„Î®ÏÎ¹", price:5.50 },
            { id:"p_wine_carafe", cat:"wine", name:"ÎšÏÎ±ÏƒÎ¯ ÎºÎ±ÏÎ¬Ï†Î± (0,5l)", price:12.00 },
            { id:"p_wine_bottle_22", cat:"wine", name:"Î¦Î¹Î¬Î»Î· ÎºÏÎ±ÏƒÎ¯ (22â‚¬)", price:22.00 },
            { id:"p_wine_bottle_28", cat:"wine", name:"Î¦Î¹Î¬Î»Î· ÎºÏÎ±ÏƒÎ¯ (28â‚¬)", price:28.00 },
            { id:"p_prosecco_glass", cat:"wine", name:"Prosecco Ï€Î¿Ï„Î®ÏÎ¹", price:6.50 },

            { id:"p_whisky_std", cat:"spirit", name:"ÎŸÏ…Î¯ÏƒÎºÎ¹ standard (4cl)", price:8.50 },
            { id:"p_whisky_premium", cat:"spirit", name:"Premium Î¿Ï…Î¯ÏƒÎºÎ¹ (4cl)", price:10.50 },
            { id:"p_vodka", cat:"spirit", name:"Î’ÏŒÏ„ÎºÎ± (4cl)", price:8.00 },
            { id:"p_rum", cat:"spirit", name:"Î¡Î¿ÏÎ¼Î¹ (4cl)", price:8.50 },
            { id:"p_gin", cat:"spirit", name:"Î¤Î¶Î¹Î½ (4cl)", price:8.50 },
            { id:"p_ouzo_tsipouro", cat:"spirit", name:"ÎŸÏÎ¶Î¿ / Î¤ÏƒÎ¯Ï€Î¿Ï…ÏÎ¿ (4cl)", price:7.50 },
            { id:"p_liqueur", cat:"spirit", name:"Î›Î¹ÎºÎ­Ï (4cl)", price:7.50 },

            { id:"p_mojito", cat:"cocktail", name:"Mojito", price:9.50 },
            { id:"p_caipirinha", cat:"cocktail", name:"Caipirinha", price:9.50 },
            { id:"p_margarita", cat:"cocktail", name:"Margarita", price:10.00 },
            { id:"p_aperol", cat:"cocktail", name:"Aperol Spritz", price:8.50 },
            { id:"p_gin_tonic", cat:"cocktail", name:"Gin Tonic", price:9.00 },
            { id:"p_negroni", cat:"cocktail", name:"Negroni", price:10.50 },

            { id:"p_extra_decaf", cat:"extras", name:"Decaf (+)", price:0.30 },
            { id:"p_extra_plant_milk", cat:"extras", name:"Î¦Ï…Ï„Î¹ÎºÏŒ Î³Î¬Î»Î± (+)", price:0.50 }
          ]
        },
        days: {}
      };
    }

    let db = loadDB() || defaultDB();
    function saveDB(){ localStorage.setItem(LS_KEY, JSON.stringify(db)); }

    function ensureDay(){
      if(!db.days[TODAY]) db.days[TODAY] = { tables:{}, payments:[] };
      for(const t of db.tables){
        if(!db.days[TODAY].tables[t.id]) db.days[TODAY].tables[t.id] = { items:[] };
      }
    }
    ensureDay(); saveDB();

    function getUser(){ return db.users.find(u=>u.id===db.currentUserId) || db.users[0]; }

    function setTop(){
      el("shopNameTop").textContent = db.shopName || "â€”";
      const u = getUser();
      el("topSub").textContent = `${TODAY} â€¢ Î•Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±: ${u?.name || "â€”"}`;
      document.title = db.shopName || "Daily Cashier";
    }

    function fillUsers(){
      const sel = el("userSelect");
      sel.innerHTML = "";
      for(const u of db.users){
        const opt = document.createElement("option");
        opt.value = u.id;
        opt.textContent = u.name;
        if(u.id===db.currentUserId) opt.selected = true;
        sel.appendChild(opt);
      }
    }

    let state = { screen:"home", tableId:null, categoryId:null };
    function gotoHome(){ state.screen="home"; state.tableId=null; render(); }
    function gotoTable(tid){ state.screen="table"; state.tableId=tid; render(); }
    function gotoAdd(tid){ state.screen="add"; state.tableId=tid; state.categoryId = state.categoryId || db.menu.categories[0]?.id; render(); }
    function gotoPay(tid){ state.screen="pay"; state.tableId=tid; render(); }
    function gotoSummary(){ state.screen="summary"; state.tableId=null; render(); }

    function dayTable(tid){ ensureDay(); return db.days[TODAY].tables[tid]; }
    function unpaidItems(tid){ return dayTable(tid).items.filter(it => !it.paid && !it.voided); }
    function tableTotal(tid){ return unpaidItems(tid).reduce((s,it)=>s+it.price,0); }

    function groupUnpaid(tid){
      const map = new Map();
      for(const it of unpaidItems(tid)){
        const k = it.prodId + "|" + it.price;
        if(!map.has(k)) map.set(k, { prodId: it.prodId, name: it.name, price: it.price, qty:0 });
        map.get(k).qty += 1;
      }
      return [...map.values()];
    }

    function addProductToTable(prodId){
      const tid = state.tableId;
      const p = db.menu.products.find(x=>x.id===prodId);
      if(!tid || !p) return;
      dayTable(tid).items.push({
        id: uid(), prodId:p.id, name:p.name, cat:p.cat, price:Number(p.price),
        ts: Date.now(), by: getUser()?.name || "", paid:null, voided:false
      });
      saveDB(); render();
    }

    function removeOneUnit(tid, prodId){
      const items = dayTable(tid).items;
      const idx = items.findIndex(it => it.prodId===prodId && !it.paid && !it.voided);
      if(idx>=0){ items.splice(idx,1); saveDB(); render(); }
    }

    function setBottomButtons(btns, fullMode=false){
      bottomBar.className = "bar" + (fullMode ? " full" : "");
      bottomBar.innerHTML = "";
      if(!btns || btns.length===0){ bottom.style.display="none"; return; }
      bottom.style.display="block";
      for(const b of btns){
        const btn = document.createElement("button");
        btn.className = "btn pressable " + (b.kind||"") + (b.full ? " full" : "");
        btn.textContent = b.text;
        btn.addEventListener("click", (ev)=>{ addRipple(btn, ev.clientX, ev.clientY); haptic(12); b.onClick(); });
        bottomBar.appendChild(btn);
        makePressable(btn, 12);
      }
    }

    function renderHome(){
      view.innerHTML = `
        <div class="tables">
          ${db.tables.map(t=>{
            const total = tableTotal(t.id);
            const count = unpaidItems(t.id).length;
            const open = total>0;
            return `
              <button class="tbtn pressable" data-tid="${t.id}">
                <div class="title">
                  <span class="led ${open ? "open" : ""}"></span>
                  ${t.label}
                </div>
                <div class="sub">${open ? ("Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿: " + euro(total)) : "â€”"}</div>
                <div class="badge">${count}</div>
              </button>
            `;
          }).join("")}
        </div>
      `;
      view.querySelectorAll("[data-tid]").forEach(b=>{
        makePressable(b, 12);
        b.addEventListener("click", ()=> gotoTable(b.getAttribute("data-tid")));
      });

      setBottomButtons([
        { text:"Î£ÏÎ½Î¿ÏˆÎ·", kind:"accent", onClick: ()=> gotoSummary() },
        { text:"CSV", kind:"", onClick: ()=> exportCSV() },
        { text:"Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚", kind:"", onClick: ()=> alert("Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚: (Î¸Î± Ï„Î¿ ÎµÏ€ÎµÎºÏ„ÎµÎ¯Î½Î¿Ï…Î¼Îµ)") }
      ]);
    }

    function renderTable(){
      const tid = state.tableId;
      const t = db.tables.find(x=>x.id===tid);
      const groups = groupUnpaid(tid);
      const total = tableTotal(tid);

      view.innerHTML = `
        <div class="card">
          <div class="h">Î¤ÏÎ±Ï€Î­Î¶Î¹: ${t?.label || tid}</div>
          <div class="muted">Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿: <b>${euro(total)}</b></div>
        </div>

        <div class="card">
          <div class="h">Î‘Î½Î¿Î¹Ï‡Ï„Î¬ items</div>
          ${groups.length===0 ? `<div class="muted">ÎšÎ±Î¸Î±ÏÏŒ âœ…</div>` : `
            <div class="list">
              ${groups.map(g=>`
                <div class="li">
                  <div class="left">
                    <div class="name">${g.name}</div>
                    <div class="meta">${euro(g.price)} â€¢ ${g.qty} Ï„ÎµÎ¼.</div>
                  </div>
                  <div class="qty">
                    <button class="qbtn pressable" data-minus="${g.prodId}">âˆ’</button>
                    <div class="qnum">${g.qty}</div>
                    <button class="qbtn pressable" data-plus="${g.prodId}">+</button>
                  </div>
                </div>
              `).join("")}
            </div>
          `}
        </div>
      `;

      view.querySelectorAll("[data-minus]").forEach(b=>{
        makePressable(b, 10);
        b.addEventListener("click", ()=> removeOneUnit(tid, b.getAttribute("data-minus")));
      });
      view.querySelectorAll("[data-plus]").forEach(b=>{
        makePressable(b, 10);
        b.addEventListener("click", ()=> addProductToTable(b.getAttribute("data-plus")));
      });

      /* Î Î›Î—Î¡Î©ÎœÎ— full-width */
      setBottomButtons([
        { text:"â† Î Î¯ÏƒÏ‰", kind:"", onClick: ()=> gotoHome() },
        { text:"+ Î ÏÎ¿ÏŠÏŒÎ½", kind:"accent", onClick: ()=> gotoAdd(tid) },
        { text:"Î Î›Î—Î¡Î©ÎœÎ—", kind:"good", full:true, onClick: ()=> gotoPay(tid) }
      ], true);
    }

    function renderAdd(){
      const tid = state.tableId;
      const t = db.tables.find(x=>x.id===tid);
      const cats = db.menu.categories;
      const activeCat = state.categoryId || cats[0]?.id;
      const products = db.menu.products.filter(p=>p.cat===activeCat);

      view.innerHTML = `
        <div class="card">
          <div class="h">+ Î ÏÎ¿ÏŠÏŒÎ½ â€¢ ${t?.label || tid}</div>
          <div class="muted">Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿: <b>${euro(tableTotal(tid))}</b></div>
        </div>

        <div class="card">
          <div class="h">ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚</div>
          <div class="chips">
            ${cats.map(c=>`
              <button class="chip pressable ${c.id===activeCat?"active":""}" data-cat="${c.id}">
                ${c.emoji} ${c.name}
              </button>
            `).join("")}
          </div>
        </div>

        <div class="card">
          <div class="h">Î ÏÎ¿ÏŠÏŒÎ½Ï„Î±</div>
          <div class="list">
            ${products.map(p=>`
              <div class="li pressable" data-add="${p.id}">
                <div class="left">
                  <div class="name">${p.name}</div>
                  <div class="meta">${euro(p.price)}</div>
                </div>
                <div class="price">${euro(p.price)}</div>
              </div>
            `).join("")}
          </div>
        </div>
      `;

      view.querySelectorAll("[data-cat]").forEach(b=>{
        makePressable(b, 10);
        b.addEventListener("click", ()=>{ state.categoryId=b.getAttribute("data-cat"); render(); });
      });
      view.querySelectorAll("[data-add]").forEach(li=>{
        makePressable(li, 10);
        li.addEventListener("click", ()=> addProductToTable(li.getAttribute("data-add")));
      });

      setBottomButtons([
        { text:"â† Î Î¯ÏƒÏ‰", kind:"", onClick: ()=> gotoTable(tid) },
        { text:"Î Î›Î—Î¡Î©ÎœÎ—", kind:"good", full:true, onClick: ()=> gotoPay(tid) }
      ], true);
    }

    function renderPay(){
      const tid = state.tableId;
      const t = db.tables.find(x=>x.id===tid);
      const total = tableTotal(tid);

      view.innerHTML = `
        <div class="card">
          <div class="h">Î Î»Î·ÏÏ‰Î¼Î® â€¢ ${t?.label || tid}</div>
          <div class="muted">Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿: <b>${euro(total)}</b></div>
          <div class="row" style="margin-top:10px;">
            <button class="btn pressable good" style="flex:1;" id="payCash">ÎœÎµÏ„ÏÎ·Ï„Î¬</button>
            <button class="btn pressable accent" style="flex:1;" id="payCard">ÎšÎ¬ÏÏ„Î±</button>
          </div>
        </div>
      `;

      makePressable(el("payCash"), 14);
      makePressable(el("payCard"), 14);

      el("payCash").addEventListener("click", ()=> payAll(tid,"cash"));
      el("payCard").addEventListener("click", ()=> payAll(tid,"card"));

      setBottomButtons([
        { text:"â† Î Î¯ÏƒÏ‰", kind:"", onClick: ()=> gotoTable(tid) }
      ]);
    }

    function payAll(tid, method){
      const items = unpaidItems(tid);
      if(items.length===0){ gotoHome(); return; }
      const u = getUser()?.name || "";
      const ts = Date.now();
      for(const it of items){
        it.paid = { method, ts, by:u };
        db.days[TODAY].payments.push({ id:uid(), tableId:tid, prodId:it.prodId, name:it.name, price:it.price, method, ts, by:u });
      }
      saveDB();
      gotoHome();
    }

    function renderSummary(){
      const pay = db.days[TODAY].payments || [];
      const totals = { cash:0, card:0, all:0 };
      for(const p of pay){
        totals.all += p.price;
        if(p.method==="cash") totals.cash += p.price;
        if(p.method==="card") totals.card += p.price;
      }

      view.innerHTML = `
        <div class="card">
          <div class="h">Î£ÏÎ½Î¿ÏˆÎ· â€¢ ${TODAY}</div>
          <div class="muted">Î£ÏÎ½Î¿Î»Î¿: <b>${euro(totals.all)}</b></div>
          <div class="muted">ÎœÎµÏ„ÏÎ·Ï„Î¬: <b>${euro(totals.cash)}</b> â€¢ ÎšÎ¬ÏÏ„Î±: <b>${euro(totals.card)}</b></div>
        </div>

        <div class="card">
          <div class="h">Î Î»Î·ÏÏ‰Î¼Î­Ï‚ (${pay.length})</div>
          <div class="list">
            ${pay.slice().reverse().map(p=>`
              <div class="li">
                <div class="left">
                  <div class="name">${p.name}</div>
                  <div class="meta">${p.tableId} â€¢ ${new Date(p.ts).toLocaleTimeString("el-GR",{hour:"2-digit",minute:"2-digit"})} â€¢ ${p.by}</div>
                </div>
                <div class="price">${euro(p.price)}</div>
              </div>
            `).join("") || `<div class="li"><div class="muted2">â€”</div></div>`}
          </div>
        </div>
      `;

      setBottomButtons([
        { text:"â† Home", kind:"", onClick: ()=> gotoHome() },
        { text:"CSV", kind:"", onClick: ()=> exportCSV() }
      ]);
    }

    function exportCSV(){
      const pay = db.days[TODAY].payments || [];
      const rows = [["date","time","table","product","price","method","user"].join(",")];
      for(const p of pay){
        const d = new Date(p.ts);
        rows.push([
          TODAY,
          d.toLocaleTimeString("el-GR",{hour:"2-digit",minute:"2-digit"}),
          p.tableId,
          `"${String(p.name).replaceAll('"','""')}"`,
          Number(p.price).toFixed(2),
          p.method,
          `"${String(p.by||"").replaceAll('"','""')}"`
        ].join(","));
      }
      const blob = new Blob([rows.join("\n")], {type:"text/csv;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `daily_cashier_${TODAY}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function render(){
      setTop();
      if(state.screen==="home") renderHome();
      else if(state.screen==="table") renderTable();
      else if(state.screen==="add") renderAdd();
      else if(state.screen==="pay") renderPay();
      else if(state.screen==="summary") renderSummary();
    }

    /* User PIN */
    el("userSelect").addEventListener("change", ()=>{
      // Î±Ï€Î»ÏŒ: Î´ÎµÎ½ Î±Î»Î»Î¬Î¶Ï‰ ÎµÎ´Ï PIN flow Î³Î¹Î± Î½Î± Î¼Î·Î½ Ï„Î¿ ÎºÎ¬Î½Ï‰ Î²Î±ÏÏ Ï„ÏÏÎ±
      db.currentUserId = el("userSelect").value;
      saveDB();
      setTop();
    });

    el("btnSettings").addEventListener("click", (ev)=>{
      addRipple(el("btnSettings"), ev.clientX, ev.clientY);
      haptic(12);
      alert("Î“Î¹Î± Î½Î± Ï†ÏÎ³Î¿Ï…Î½ Î¿Î¹ Chrome Î¼Ï€Î¬ÏÎµÏ‚: Install (Add to Home Screen) ÎºÎ±Î¹ Î¬Î½Î¿Î¹Î³Î¼Î± Î±Ï€ÏŒ Ï„Î¿ ÎµÎ¹ÎºÎ¿Î½Î¯Î´Î¹Î¿.");
    });
    makePressable(el("btnSettings"), 10);

    async function registerSW(){
      if(!("serviceWorker" in navigator)) return;
      try{
        const reg = await navigator.serviceWorker.register("./sw.js", { scope:"./" });
        if(reg.update) reg.update();
      }catch(e){}
    }

    fillUsers();
    render();
    registerSW();
  </script>
</body>
</html>