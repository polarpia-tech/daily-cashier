<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Î—Î¼ÎµÏÎ®ÏƒÎ¹Î¿ Î¤Î±Î¼ÎµÎ¯Î¿</title>

  <style>
    :root{
      --bg:#0b0f14;
      --card:#141a22;
      --line:rgba(255,255,255,.10);
      --text:#eef2ff;
      --muted:#a9b1c3;
      --accent:#4cc3ff;
      --ok:#44d08a;
      --bad:#ff6363;

      --r:16px;
      --pad:12px;
      --tap:42px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background: var(--bg);
      color: var(--text);
      overflow-x:hidden;

      /* Android fix: Î¼Î·Î½ ÎºÎ¬Î½ÎµÎ¹ â€œÎ±Ï…Ï„Î¿-Î¼ÎµÎ³Î­Î¸Ï…Î½ÏƒÎ·â€ ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½ */
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }

    .wrap{ width:min(980px, calc(100% - 16px)); margin:0 auto; }

    /* ------- HEADER (Ï€Î¿Î»Ï Ï€Î¹Î¿ compact) ------- */
    header{ padding:10px 0 6px; }
    .top{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand b{ font-size:18px; }
    .brand .muted{ font-size:12px; color:var(--muted); }

    .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .pill{
      display:flex; gap:8px; align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      white-space:nowrap;
      font-size:13px;
    }
    .pill b{ color:var(--text); }

    select{
      height: var(--tap);
      border-radius: 12px;
      padding:0 10px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      outline:none;
      font-size:14px;
    }

    /* ------- BUTTONS ------- */
    .btn{
      height: var(--tap);
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      font-weight:700;
      padding:0 12px;
      cursor:pointer;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ border-color: rgba(76,195,255,.45); }
    .btn.ok{ border-color: rgba(68,208,138,.55); }
    .btn.bad{ border-color: rgba(255,99,99,.55); background: rgba(255,99,99,.08); }
    .tabs{
      display:flex; gap:6px;
      padding:6px;
      border-radius: 16px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.02);
    }
    .tab{ flex:1; min-width:120px; background:transparent; }
    .tab.active{
      background: rgba(76,195,255,.12);
      border-color: rgba(76,195,255,.45);
    }

    .divider{ height:1px; background: var(--line); margin:10px 0; }

    /* ------- LAYOUT ------- */
    main{ padding: 6px 0 14px; }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 860px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }

    .card{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.02);
      padding: var(--pad);
      overflow:hidden;
    }
    .title{ font-size:16px; font-weight:900; }
    .muted{ color:var(--muted); font-size:13px; }

    /* ------- TABLES GRID (mobile-first) ------- */
    #tablesGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (min-width:520px){ #tablesGrid{ grid-template-columns: 1fr 1fr 1fr; } }
    @media (min-width:860px){ #tablesGrid{ grid-template-columns: 1fr 1fr 1fr 1fr; } }

    #tablesGrid button{
      height: 56px;
      border-radius: 16px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:4px;
      font-weight:900;
      font-size:15px;
    }
    #tablesGrid button .sub{ font-size:12px; color:var(--muted); font-weight:700; }

    /* ------- CATEGORIES ------- */
    #catsRow{
      display:flex;
      gap:8px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom:6px;
    }
    #catsRow .btn{
      height: 40px;
      border-radius: 12px;
      white-space:nowrap;
      font-size:13px;
    }

    /* ------- PRODUCTS ------- */
    #productsList{ display:flex; flex-direction:column; gap:10px; }
    .product{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding: 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
    }
    .product b{ font-size:15px; }
    .price{ font-weight:900; }

    input[type="search"]{
      height: var(--tap);
      border-radius: 12px;
      padding: 0 10px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      outline:none;
      width: 100%;
      max-width: 220px;
    }

    /* ------- TICKET LIST ------- */
    #ticketList{ display:flex; flex-direction:column; gap:10px; }
    .line{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
    }

    /* ------- ACTIONS (Î£Ï„Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ Î”Î•Î ÎµÎ¯Î½Î±Î¹ fixed) ------- */
    .actions{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (min-width:760px){
      .actions{ grid-template-columns: 1fr 1fr 1fr 1fr; }
    }
    .actions .btn{
      height: 46px;
      font-size:13px;
      white-space:nowrap;
    }

    /* extra mobile tightening */
    @media (max-width:420px){
      :root{ --tap:40px; --pad:10px; }
      .brand b{ font-size:16px; }
      input[type="search"]{ max-width: 100%; }
      .tab{ min-width: 0; }
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <b>Î—Î¼ÎµÏÎ®ÏƒÎ¹Î¿ Î¤Î±Î¼ÎµÎ¯Î¿</b>
        <div class="muted" id="todayPill">Î£Î®Î¼ÎµÏÎ±: â€”</div>
      </div>

      <div class="row">
        <select id="userSelect" title="Î§ÏÎ®ÏƒÏ„Î·Ï‚"></select>
        <div class="pill">Î¤ÏÎ±Ï€Î­Î¶Î¹: <b id="activeTable">â€”</b> Â· Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿: <b id="activeBal">0,00 â‚¬</b></div>
      </div>

      <div class="tabs" style="width:100%;">
        <button class="btn tab active" id="tabOrder">Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±</button>
        <button class="btn tab" id="tabTickets">Tickets</button>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="grid">

      <section class="card">
        <div class="title">Î“ÏÎ®Î³Î¿ÏÎ· ÎµÏ€Î¹Î»Î¿Î³Î® Ï„ÏÎ±Ï€ÎµÎ¶Î¹Î¿Ï</div>
        <div class="muted">Î Î¬Ï„Î± Ï„ÏÎ±Ï€Î­Î¶Î¹ â†’ Î¼ÎµÏ„Î¬ Î²Î¬Î»Îµ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î±.</div>
        <div class="divider"></div>
        <div id="tablesGrid"></div>

        <div class="divider"></div>

        <div class="title" style="margin-bottom:6px;">Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</div>
        <div class="actions">
          <button class="btn ok" id="btnUndoPay">Î‘Î½Î±Î¯ÏÎµÏƒÎ· Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î±Ï‚ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚</button>
          <button class="btn primary" id="btnRedoPay">Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Ï€Î»Î·ÏÏ‰Î¼Î® Î¾Î±Î½Î¬</button>
          <button class="btn" id="btnCSV">Î•Î¾Î±Î³Ï‰Î³Î® CSV</button>
          <button class="btn bad" id="btnWipeDay">Î”Î¹Î±Î³ÏÎ±Ï†Î® Î·Î¼Î­ÏÎ±Ï‚</button>
        </div>
      </section>

      <section class="card">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div class="title">Î ÏÎ¿ÏŠÏŒÎ½Ï„Î±</div>
            <div class="muted">ÎŒ,Ï„Î¹ Ï€Î±Ï„Î¬Ï‚ Î¼Ï€Î±Î¯Î½ÎµÎ¹ ÏƒÏ„Î¿ ÎµÎ½ÎµÏÎ³ÏŒ Ï„ÏÎ±Ï€Î­Î¶Î¹.</div>
          </div>
          <input id="search" type="search" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·â€¦">
        </div>

        <div class="divider"></div>
        <div id="catsRow"></div>
        <div class="divider"></div>
        <div id="productsList"></div>
      </section>

      <section class="card" id="orderCard">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div class="title">Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±</div>
            <div class="muted">Î‘Î½Î¿Î¹Ï‡Ï„ÏŒ: <b id="openTotal">0,00 â‚¬</b></div>
          </div>
          <button class="btn primary" id="btnPaySplit">Î Î»Î·ÏÏ‰Î¼Î® / Split</button>
        </div>
        <div class="divider"></div>
        <div id="ticketList"></div>
      </section>

      <section class="card" id="ticketsCard" style="display:none;">
        <div class="title">Tickets</div>
        <div class="muted">Î‘Î½Î¿Î¹Ï‡Ï„Î¬ Ï„ÏÎ±Ï€Î­Î¶Î¹Î±</div>
        <div class="divider"></div>
        <div id="ticketsList"></div>
      </section>

    </div>
  </div>
</main>

<script>
(() => {
  const LS_KEY = "mini-cashier-db-v6";
  const LS_USERS = "mini-cashier-users-v4";
  const LS_USER = "mini-cashier-current-user-v4";
  const TODAY = new Date().toISOString().slice(0,10);

  const fmtEUR = (n) => (n||0).toFixed(2).replace(".", ",") + " â‚¬";
  const $ = (id) => document.getElementById(id);
  const uid = () => Math.random().toString(16).slice(2)+Date.now().toString(16);

  const menu = [
    {cat:"â˜• ÎšÎ‘Î¦Î•Î”Î•Î£ â€“ Î–Î•Î£Î¤ÎŸÎ™", items:[
      ["Espresso Î¼Î¿Î½ÏŒÏ‚",2.60],["Espresso Î´Î¹Ï€Î»ÏŒÏ‚",3.20],["Espresso macchiato",2.90],["Americano",3.20],
      ["Cappuccino",3.60],["Cappuccino Î´Î¹Ï€Î»ÏŒÏ‚",4.20],["Latte macchiato",4.20],["Flat white",4.40],
      ["Mocha",4.50],["ÎšÎ±Ï†Î­Ï‚ Ï†Î¯Î»Ï„ÏÎ¿Ï…",3.00]
    ]},
    {cat:"â„ï¸ ÎšÎ‘Î¦Î•Î”Î•Î£ â€“ ÎšÎ¡Î¥ÎŸÎ™", items:[
      ["Freddo espresso",3.80],["Freddo cappuccino",4.20],["Iced latte",4.50],["Frappe",3.50]
    ]},
    {cat:"ğŸ¥¤ Î‘ÎÎ‘Î¨Î¥ÎšÎ¤Î™ÎšÎ‘ â€“ ÎÎ•Î¡Î‘", items:[
      ["Coca-Cola / Zero / Fanta (0,33l)",3.40],["Ice Tea",3.60],
      ["ÎœÎµÏ„Î±Î»Î»Î¹ÎºÏŒ Î½ÎµÏÏŒ (0,33l)",2.80],["ÎœÎµÏ„Î±Î»Î»Î¹ÎºÏŒ Î½ÎµÏÏŒ (0,75l)",5.50]
    ]},
    {cat:"ğŸº ÎœÎ Î¥Î¡Î•Î£", items:[
      ["ÎœÏ€ÏÏÎ± Î²Î±ÏÎµÎ»Î¯ÏƒÎ¹Î± (0,5l)",5.20],["ÎœÏ€ÏÏÎ± ÎµÎ¼Ï†Î¹Î±Î»Ï‰Î¼Î­Î½Î· (0,33l)",4.20]
    ]},
    {cat:"ğŸ¥ƒ Î ÎŸÎ¤Î‘ (4cl)", items:[
      ["ÎŸÏ…Î¯ÏƒÎºÎ¹ standard",8.50],["Î’ÏŒÏ„ÎºÎ±",8.00],["Î¤Î¶Î¹Î½",8.50]
    ]}
  ];

  const DEFAULT_TABLES = ["T1","T2","T3","T4","T5","T6","T7","T8","T9","T10","T11","T12","T13","T14","T15","T16","T17","BAR","Î•ÎÎ©"];

  const load = (k, fallback) => {
    try { return JSON.parse(localStorage.getItem(k) || "null") ?? fallback; } catch { return fallback; }
  };
  const save = (k,v) => localStorage.setItem(k, JSON.stringify(v));

  function ensureDB(){
    const db = load(LS_KEY, { days:{} });
    if(!db.days) db.days = {};
    if(!db.days[TODAY]) db.days[TODAY] = { tables:{}, meta:{}, payments:[] };
    if(!db.days[TODAY].tables) db.days[TODAY].tables = {};
    DEFAULT_TABLES.forEach(t=>{
      if(!db.days[TODAY].tables[t]) db.days[TODAY].tables[t] = { open:[] };
    });
    if(!db.days[TODAY].meta.activeTable) db.days[TODAY].meta.activeTable = "T1";
    save(LS_KEY, db);
    return db;
  }

  function ensureUsers(){
    let users = load(LS_USERS, null);
    if(!users || !Array.isArray(users) || users.length===0){
      users = ["Î§ÏÎ®ÏƒÏ„Î·Ï‚ 1"];
      save(LS_USERS, users);
      save(LS_USER, users[0]);
    }
    return users;
  }

  function currentUser(){
    const users = ensureUsers();
    let u = localStorage.getItem(LS_USER) || users[0];
    if(!users.includes(u)){ u = users[0]; save(LS_USER,u); }
    return u;
  }

  function setActiveTable(t){
    const db = ensureDB();
    db.days[TODAY].meta.activeTable = t;
    save(LS_KEY, db);
    renderAll();
  }

  function openLines(db, table){
    const tbl = db.days[TODAY].tables[table];
    if(!tbl.open) tbl.open = [];
    return tbl.open;
  }

  function openTotal(lines){
    return lines.filter(x=>!x.paid).reduce((s,x)=>s+x.price,0);
  }

  function buildUsers(){
    const users = ensureUsers();
    const sel = $("userSelect");
    sel.innerHTML="";
    users.forEach(u=>{
      const opt=document.createElement("option");
      opt.value=u; opt.textContent=u;
      sel.appendChild(opt);
    });
    sel.value = currentUser();
    sel.onchange=()=>{ save(LS_USER, sel.value); renderAll(); };
  }

  function buildTables(){
    const db = ensureDB();
    const active = db.days[TODAY].meta.activeTable;

    const wrap = $("tablesGrid");
    wrap.innerHTML="";
    DEFAULT_TABLES.forEach(t=>{
      const lines = openLines(db, t);
      const sum = openTotal(lines);
      const btn = document.createElement("button");
      btn.className = "btn " + (t===active ? "primary" : "");
      if(sum>0) btn.style.borderColor = "rgba(68,208,138,.55)";
      btn.innerHTML = `<div>${t}</div><div class="sub">${sum>0?fmtEUR(sum):"â€”"}</div>`;
      btn.onclick=()=>setActiveTable(t);
      wrap.appendChild(btn);
    });
  }

  let activeCat = menu[0].cat;

  function buildCats(){
    const row = $("catsRow");
    row.innerHTML="";
    menu.forEach(c=>{
      const b=document.createElement("button");
      b.className = "btn " + (c.cat===activeCat ? "primary" : "");
      b.textContent = c.cat;
      b.onclick=()=>{ activeCat=c.cat; buildCats(); buildProducts(); };
      row.appendChild(b);
    });
  }

  function addLine(name, cat, price){
    const db = ensureDB();
    const t = db.days[TODAY].meta.activeTable;
    openLines(db,t).push({id:uid(), name, cat, price, ts:Date.now(), paid:null});
    save(LS_KEY, db);
    renderAll();
  }

  function buildProducts(){
    const q = ($("search").value||"").trim().toLowerCase();
    const list = $("productsList");
    list.innerHTML="";
    const cat = menu.find(x=>x.cat===activeCat);
    if(!cat) return;
    cat.items
      .filter(([n])=> !q || n.toLowerCase().includes(q))
      .forEach(([name,price])=>{
        const el=document.createElement("div");
        el.className="product";
        el.innerHTML = `<div><b>${name}</b><div class="muted">${activeCat}</div></div><div class="price">${fmtEUR(price)}</div>`;
        el.onclick=()=>addLine(name, activeCat, price);
        list.appendChild(el);
      });
  }

  let view="order";
  $("tabOrder").onclick=()=>{
    view="order";
    $("tabOrder").classList.add("active");
    $("tabTickets").classList.remove("active");
    $("orderCard").style.display="";
    $("ticketsCard").style.display="none";
  };
  $("tabTickets").onclick=()=>{
    view="tickets";
    $("tabTickets").classList.add("active");
    $("tabOrder").classList.remove("active");
    $("orderCard").style.display="none";
    $("ticketsCard").style.display="";
    renderTickets();
  };

  function renderTicket(){
    const db = ensureDB();
    const t = db.days[TODAY].meta.activeTable;
    $("activeTable").textContent = t;

    const lines = openLines(db, t);
    const sum = openTotal(lines);
    $("activeBal").textContent = fmtEUR(sum);
    $("openTotal").textContent = fmtEUR(sum);

    const list=$("ticketList");
    list.innerHTML="";
    if(lines.length===0){
      list.innerHTML = `<div class="muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï„Î¯Ï€Î¿Ï„Î± Î±ÎºÏŒÎ¼Î±.</div>`;
      return;
    }
    lines.slice().reverse().forEach(line=>{
      const status = line.paid ? "Î Î»Î·ÏÏ‰Î¼Î­Î½Î¿" : "Î‘Î½Î¿Î¹Ï‡Ï„ÏŒ";
      const row=document.createElement("div");
      row.className="line";
      row.innerHTML = `<div><b>${line.name}</b><div class="muted">${line.cat} Â· ${status}</div></div><div><b>${fmtEUR(line.price)}</b></div>`;
      list.appendChild(row);
    });
  }

  function renderTickets(){
    const db = ensureDB();
    const wrap=$("ticketsList");
    wrap.innerHTML="";
    DEFAULT_TABLES.forEach(t=>{
      const sum = openTotal(openLines(db,t));
      if(sum<=0) return;
      const row=document.createElement("div");
      row.className="line";
      row.innerHTML = `<div><b>${t}</b><div class="muted">Î‘Î½Î¿Î¹Ï‡Ï„ÏŒ</div></div><div><b>${fmtEUR(sum)}</b></div>`;
      row.onclick=()=>{ setActiveTable(t); $("tabOrder").click(); };
      wrap.appendChild(row);
    });
    if(!wrap.children.length) wrap.innerHTML = `<div class="muted">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Î½Î¿Î¹Ï‡Ï„Î¬ tickets.</div>`;
  }

  // (Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬) Î Î»Î·ÏÏ‰Î¼Î®/split: Î¸Î± Ï„Î¿ Î¾Î±Î½Î±Î²Î¬Î»Î¿Ï…Î¼Îµ ÏƒÏ‰ÏƒÏ„Î¬ Î±Ï†Î¿Ï ÏƒÏ„ÏÏÏƒÎµÎ¹ Ï„Î¿ mobile UI
  $("btnPaySplit").onclick=()=>alert("Î Î»Î·ÏÏ‰Î¼Î®/Split: Î¸Î± Ï„Î¿ Î²Î¬Î»Î¿Ï…Î¼Îµ ÏƒÏ„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î²Î®Î¼Î±.");

  // Undo/Redo/CSV/Wipe (Î¼Î¯Î½Î¹)
  $("btnUndoPay").onclick=()=>alert("Undo: Î¸Î± Ï„Î¿ ÏƒÏ…Î½Î´Î­ÏƒÎ¿Ï…Î¼Îµ ÏƒÏ„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î²Î®Î¼Î±.");
  $("btnRedoPay").onclick=()=>alert("Redo: Î¸Î± Ï„Î¿ ÏƒÏ…Î½Î´Î­ÏƒÎ¿Ï…Î¼Îµ ÏƒÏ„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î²Î®Î¼Î±.");

  $("btnCSV").onclick=()=>{
    const db=ensureDB();
    const rows=[["date","table","item","category","price","paid"]];
    for(const [t,obj] of Object.entries(db.days[TODAY].tables)){
      for(const l of (obj.open||[])){
        rows.push([TODAY,t,l.name,l.cat,l.price,l.paid?"yes":"no"]);
      }
    }
    const csv = rows.map(r=>r.map(x=>`"${String(x).replaceAll('"','""')}"`).join(",")).join("\n");
    const blob=new Blob([csv],{type:"text/csv;charset=utf-8"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download=`cashier_${TODAY}.csv`;
    a.click();
    URL.revokeObjectURL(a.href);
  };

  $("btnWipeDay").onclick=()=>{
    if(!confirm("Î”Î¹Î±Î³ÏÎ±Ï†Î® ÏƒÎ·Î¼ÎµÏÎ¹Î½Î®Ï‚ Î·Î¼Î­ÏÎ±Ï‚;")) return;
    const db=ensureDB();
    delete db.days[TODAY];
    save(LS_KEY, db);
    renderAll();
  };

  function renderAll(){
    $("todayPill").textContent="Î£Î®Î¼ÎµÏÎ±: "+TODAY;
    buildUsers();
    buildTables();
    buildCats();
    buildProducts();
    renderTicket();
    if(view==="tickets") renderTickets();
  }

  $("search").addEventListener("input", buildProducts);
  renderAll();
})();
</script>
</body>
</html>
